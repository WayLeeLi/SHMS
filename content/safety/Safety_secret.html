<div id="editDialog" style="display: none" class="container">
  <div class="safety_fbox">
    <h2 style="text-align: center">公務機密維護總檢查</h2>
    <input type="hidden" id="safety_fid" />
    <br />
    <form id="inputForm">
      <table class="w-100 safe_form">
        <tbody>
          <tr>
            <td class="table-header" width="200">填報年度：</td>
            <td class="">
              <span class="itemYear"></span>
            </td>
            <td class="table-header" width="200">填報季別：</td>
            <td class="">
              <select class="custom-select w_150p" id="season" name="season">
                <option value="1">第一季度</option>
                <option value="2">第二季度</option>
                <option value="3">第三季度</option>
                <option value="4">第四季度</option>
              </select>
            </td>
          </tr>
        </tbody>
      </table>
      <br />
      <table class="w-100 safe_form" id="secret">
        <tbody>
          <tr>
            <td class="table-header text-center" width="90" rowspan="5">
              業<br />務<br />發<br />展<br />部
            </td>
            <td width="60" class="text-center">1</td>
            <td>
              金庫門副份鑰匙及備份密碼是否依規定加以密封並由正、副主管妥為保管﹖
            </td>
            <td>
              <select class="custom-select w_150p">
                <option value="不適用">不適用</option>
                <option value="是">是</option>
                <option value="否">否</option>
              </select>
            </td>
          </tr>
          <tr>
            <td width="60" class="text-center">2-1</td>
            <td>金庫門密碼鎖掌管人員異動時，是否即時更換密碼﹖</td>
            <td>
              <select class="custom-select w_150p">
                <option value="不適用">不適用</option>
                <option value="是">是</option>
                <option value="否">否</option>
              </select>
            </td>
          </tr>
          <tr>
            <td width="60" class="text-center">2-2</td>
            <td>各掌管人員是否均能獨自操作換碼﹖</td>
            <td>
              <select class="custom-select w_150p">
                <option value="不適用">不適用</option>
                <option value="是">是</option>
                <option value="否">否</option>
              </select>
            </td>
          </tr>
          <tr>
            <td width="60" class="text-center">2-3</td>
            <td>操作時是否有採取保密措施﹖</td>
            <td>
              <select class="custom-select w_150p">
                <option value="不適用">不適用</option>
                <option value="是">是</option>
                <option value="否">否</option>
              </select>
            </td>
          </tr>
          <tr>
            <td width="60" class="text-center">3</td>
            <td>
              提供本行客戶相關交易明細及存(匯)等資料予查詢機關(構)時，是否以密件方式處理，並提示來函詢查單位應予保密﹖
            </td>
            <td>
              <select class="custom-select w_150p">
                <option value="不適用">不適用</option>
                <option value="是">是</option>
                <option value="否">否</option>
              </select>
            </td>
          </tr>
          <tr>
            <td class="table-header text-center" width="90" rowspan="2">
              <dl>
                <dd>債<br />權<br />管<br />理<br />部</dd>
                <dd>授<br />信<br />審<br />查<br />部</dd>
                <dd>調<br />查<br />研<br />究<br />部</dd>
              </dl>
            </td>
            <td width="60" class="text-center">4</td>
            <td>
              提供本行客戶相關交易明細及放款等資料予查詢機關(構)時，是否以密件方式處理，並提示來函詢查單位應予保密﹖
            </td>
            <td>
              <select class="custom-select w_150p">
                <option value="不適用">不適用</option>
                <option value="是">是</option>
                <option value="否">否</option>
              </select>
            </td>
          </tr>
          <tr>
            <td width="60" class="text-center">4-1</td>
            <td>
              重要債權憑證、徵(授)信檔案及客戶印鑑卡等重要資料，是否依規保管，並於下班後確實上鎖﹖
            </td>
            <td>
              <select class="custom-select w_150p">
                <option value="不適用">不適用</option>
                <option value="是">是</option>
                <option value="否">否</option>
              </select>
            </td>
          </tr>

          <tr>
            <td class="table-header text-center" width="90" rowspan="10">
              行<br />政<br />管<br />理<br />部
            </td>
            <td width="60" class="text-center">5-1</td>
            <td>密等文書是否指定專人保管﹖</td>
            <td>
              <select class="custom-select w_150p">
                <option value="不適用">不適用</option>
                <option value="是">是</option>
                <option value="否">否</option>
              </select>
            </td>
          </tr>
          <tr>
            <td width="60" class="text-center">5-2</td>
            <td>是否有設置密等公文登記簿備查﹖</td>
            <td>
              <select class="custom-select w_150p">
                <option value="不適用">不適用</option>
                <option value="是">是</option>
                <option value="否">否</option>
              </select>
            </td>
          </tr>
          <tr>
            <td width="60" class="text-center">6</td>
            <td>密等文書之等級變更及註銷是否依規定辦理﹖</td>
            <td>
              <select class="custom-select w_150p">
                <option value="不適用">不適用</option>
                <option value="是">是</option>
                <option value="否">否</option>
              </select>
            </td>
          </tr>
          <tr>
            <td width="60" class="text-center">7</td>
            <td>
              受理司法、治安機關、金融同業或客戶調(借)閱攝錄檔案時，是否確實設簿登記備查﹖
            </td>
            <td>
              <select class="custom-select w_150p">
                <option value="不適用">不適用</option>
                <option value="是">是</option>
                <option value="否">否</option>
              </select>
            </td>
          </tr>
          <tr>
            <td width="60" class="text-center">8-1</td>
            <td>單位之印信等重要章戳是否妥善存放﹖</td>
            <td>
              <select class="custom-select w_150p">
                <option value="不適用">不適用</option>
                <option value="是">是</option>
                <option value="否">否</option>
              </select>
            </td>
          </tr>
          <tr>
            <td width="60" class="text-center">8-2</td>
            <td>是否指定專人於上班時間中負責保管﹖</td>
            <td>
              <select class="custom-select w_150p">
                <option value="不適用">不適用</option>
                <option value="是">是</option>
                <option value="否">否</option>
              </select>
            </td>
          </tr>
          <tr>
            <td width="60" class="text-center">9-1</td>
            <td>
              單位主管是否確實督導同仁每日下班前檢視周遭環境不得有「印有個資或公務機密」之回收紙張﹖
            </td>
            <td>
              <select class="custom-select w_150p">
                <option value="不適用">不適用</option>
                <option value="是">是</option>
                <option value="否">否</option>
              </select>
            </td>
          </tr>
          <tr>
            <td width="60" class="text-center">9-2</td>
            <td>回收紙張是否於下班前銷毀﹖</td>
            <td>
              <select class="custom-select w_150p">
                <option value="不適用">不適用</option>
                <option value="是">是</option>
                <option value="否">否</option>
              </select>
            </td>
          </tr>
          <tr>
            <td width="60" class="text-center">9-3</td>
            <td>
              客戶提供予本行辦理查詢之資料或印有本行重要業務資訊之紙張，是否於作業完成後做妥適處理
              (裝訂/銷毀)﹖
            </td>
            <td>
              <select class="custom-select w_150p">
                <option value="不適用">不適用</option>
                <option value="是">是</option>
                <option value="否">否</option>
              </select>
            </td>
          </tr>
          <tr>
            <td width="60" class="text-center">9-4</td>
            <td>
              總務人員是否於每月抽驗後將辦理情形確實記載於「回收再利用及資源回收紙張處理紀錄表」，並核章備查﹖
            </td>
            <td>
              <select class="custom-select w_150p">
                <option value="不適用">不適用</option>
                <option value="是">是</option>
                <option value="否">否</option>
              </select>
            </td>
          </tr>
          <!-- <tr>
                    <td class="table-header text-center" width="90" rowspan="2">
                        <dl>
                            <dd>依<br />個<br />資<br />資<br />料<br />或<br />重</dd>
                            <dd>要<br />業<br />務<br />資<br />訊<br />性<br />質</dd>
                            <dd>之<br />相<br />關<br />業<br />管<br />部<br />門</dd>
                        </dl>
                    </td>
                    <td width="60" class="text-center">
                        10-1
                    </td>
                    <td>回收再利用及資源回收紙張有無集中分類放置﹖</td>
                    <td><select class="custom-select w_150p">
<option value="不適用">不適用</option>
                            <option value="是">是</option>
                            <option value="否">否</option>
                        </select>
                    </td>
                </tr>
                <tr>
                    <td width="60" class="text-center">
                        10-2
                    </td>
                    <td>對客戶所提供及本行辦理查詢之相關個資資料或本行重要業務資
                        訊之紙張，不得回收使用，並有無於作廢後立即進行銷毀﹖</td>
                    <td><select class="custom-select w_150p">
<option value="不適用">不適用</option>
                            <option value="是">是</option>
                            <option value="否">否</option>
                        </select>
                    </td>
                </tr> -->

          <tr>
            <td class="table-header text-center" width="90" rowspan="4">
              其<br />他
            </td>
            <td width="60" class="text-center">10</td>
            <td>本次檢查發現缺失共計＿項</td>
            <td><input class="w_150p" type="text" /></td>
          </tr>
          <tr>
            <td width="60" class="text-center">11</td>
            <td>已改進缺失(含上次檢查缺失)＿項</td>
            <td><input class="w_150p" type="text" /></td>
          </tr>
          <tr>
            <td width="60" class="text-center">12</td>
            <td>改善及處理情形(含上次缺失改善情形，無缺失者免填此欄位)</td>
            <td><input class="w_150p" type="text" /></td>
          </tr>
          <tr>
            <td width="60" class="text-center">13</td>
            <td>檢查日期</td>
            <td>
              <div class="date_box w_150p">
                <label>
                  <input
                    id="Date"
                    name="Date"
                    type="text"
                    readonly="readonly"
                    class="w_150p"
                    placeholder="選擇日期"
                  />
                  <i class="iconfont icon-riqi1"></i>
                </label>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
      <br />
      <table class="w-100 safe_form">
        <tbody>
          <tr>
            <td class="table-header" width="200">檢查人員 (人事管理員)</td>
            <td class="loginUser">蔡小雯</td>
            <td class="table-header" width="200">審核人員</td>
            <td class="">
              <select
                class="custom-select w_150p"
                id="reviewName"
                name="reviewName"
              ></select>
            </td>
            <td class="table-header" width="200">時間</td>
            <td class="upDate">111/04/15</td>
          </tr>
        </tbody>
      </table>
    </form>
    <br />
    <div style="text-align: center">
      <button type="button" id="submitBtn_x" class="btn btn-warning my-2">
        暫存
      </button>
      <button type="button" id="submitBtn" class="btn btn-primary my-2">
        送出
      </button>
    </div>
  </div>
</div>
<div class="m-t50 m-b30">
  <div class="date_time">
    <div class="date_box">
      <label>
        <input
          id="startDate"
          name="startDate"
          type="text"
          readonly="readonly"
          class="w_100p"
          placeholder="開始日期"
        />
        <i class="iconfont icon-riqi1"></i>
      </label>
    </div>
    <div class="date_box">
      <label>
        <input
          id="endDate"
          name="endDate"
          type="text"
          readonly="readonly"
          class="w_100p"
          placeholder="結束日期"
        />
        <i class="iconfont icon-riqi1"></i>
      </label>
    </div>
    <div class="date_box unit">
      <label>
        <input
          id="unitId_s"
          name=""
          type="text"
          class="w_100p"
          placeholder="連線代號"
        />
      </label>
    </div>
    <div class="date_box unit">
      <label>
        <input
          id="unitName_s"
          name=""
          type="text"
          class="w_100p"
          placeholder="銀行名稱"
        />
      </label>
    </div>
    <button class="btn btn-primary my-2" id="getlist_search">查詢</button>
  </div>

  <div id="jsGrid"></div>
</div>

<div id="detailDialog" style="display: none" class="container">
  <div id="printDiv">
    <h2 style="text-align: center">公務機密維護總檢查</h2>
    <input type="hidden" id="safetyId" />
    <br />
    <form id="inputForm">
      <table class="w-100 safe_form headtable">
        <tbody>
          <tr>
            <td class="table-header" width="200">填報年度：</td>
            <td class="">
              <span class="itemYear"></span>
            </td>
            <td class="table-header" width="200">填報季別：</td>
            <td class="season"></td>
          </tr>
        </tbody>
      </table>
      <br />
      <table class="w-100 safe_form" id="secret_look">
        <tbody>
          <tr>
            <td class="table-header text-center" width="90" rowspan="5">
              業<br />務<br />發<br />展<br />部
            </td>
            <td width="60" class="text-center">1</td>
            <td></td>
            <td></td>
          </tr>
          <tr>
            <td width="60" class="text-center">2-1</td>
            <td></td>
            <td></td>
          </tr>
          <tr>
            <td width="60" class="text-center">2-2</td>
            <td></td>
            <td></td>
          </tr>
          <tr>
            <td width="60" class="text-center">2-3</td>
            <td></td>
            <td></td>
          </tr>
          <tr>
            <td width="60" class="text-center">3</td>
            <td></td>
            <td></td>
          </tr>
          <tr>
            <td class="table-header text-center" width="90" rowspan="2">
              <dl>
                <dd>債<br />權<br />管<br />理<br />部</dd>
                <dd>授<br />信<br />審<br />查<br />部</dd>
                <dd>調<br />查<br />研<br />究<br />部</dd>
              </dl>
            </td>
            <td width="60" class="text-center">4</td>
            <td></td>
            <td></td>
          </tr>
          <tr>
            <td width="60" class="text-center">4-1</td>
            <td></td>
            <td></td>
          </tr>

          <tr>
            <td class="table-header text-center" width="90" rowspan="8">
              行<br />政<br />管<br />理<br />部
            </td>
            <td width="60" class="text-center">5-1</td>
            <td></td>
            <td></td>
          </tr>
          <tr>
            <td width="60" class="text-center">5-2</td>
            <td></td>
            <td></td>
          </tr>
          <tr>
            <td width="60" class="text-center">6</td>
            <td></td>
            <td></td>
          </tr>
          <tr>
            <td width="60" class="text-center">7</td>
            <td></td>
            <td></td>
          </tr>
          <tr>
            <td width="60" class="text-center">8-1</td>
            <td></td>
            <td></td>
          </tr>
          <tr>
            <td width="60" class="text-center">8-2</td>
            <td></td>
            <td></td>
          </tr>
          <tr>
            <td width="60" class="text-center">9-1</td>
            <td></td>
            <td></td>
          </tr>
          <tr>
            <td width="60" class="text-center">9-2</td>
            <td></td>
            <td></td>
          </tr>
          <tr>
            <td class="table-header text-center" width="90" rowspan="2">
              <dl>
                <dd>依<br />個<br />資<br />資<br />料<br />或<br />重</dd>
                <dd>要<br />業<br />務<br />資<br />訊<br />性<br />質</dd>
                <dd>之<br />相<br />關<br />業<br />管<br />部<br />門</dd>
              </dl>
            </td>
            <td width="60" class="text-center">10-1</td>
            <td></td>
            <td></td>
          </tr>
          <tr>
            <td width="60" class="text-center">10-2</td>
            <td></td>
            <td></td>
          </tr>

          <tr>
            <td class="table-header text-center" width="90" rowspan="4">
              其<br />他
            </td>
            <td width="60" class="text-center">11</td>
            <td></td>
            <td></td>
          </tr>
          <tr>
            <td width="60" class="text-center">12</td>
            <td></td>
            <td></td>
          </tr>
          <tr>
            <td width="60" class="text-center">13</td>
            <td></td>
            <td></td>
          </tr>
          <tr>
            <td width="60" class="text-center">14</td>
            <td></td>
            <td></td>
          </tr>
        </tbody>
      </table>
      <br />
      <table class="w-100 safe_form">
        <tbody>
          <tr>
            <td class="table-header" width="200">檢查人員 (人事管理員)</td>
            <td class="loginUser">蔡小雯</td>
            <td class="table-header" width="200">審核人員</td>
            <td class="reviewName"></td>
            <td class="table-header" width="200">時間</td>
            <td class="upDate">111/04/15</td>
          </tr>
        </tbody>
      </table>
    </form>
  </div>
  <br />
  <div class="dialog-alert" id="dialog-return">
    <div class="dialog-return">
      <textarea
        placeholder="退件原因"
        id="returnReason1"
        maxlength="100"
      ></textarea>
    </div>
    <div class="dialog-alert-button text-center">
      <button type="button" id="returncancel" class="btn btn-danger my-2">
        取消
      </button>
      <button type="button" id="returnFormSubmit" class="btn btn-primary my-2">
        確認
      </button>
    </div>
  </div>
  <div style="text-align: center">
    <button
      type="button"
      id="submitBtn_s"
      class="btn btn-success my-2 pressing_hide reviewButton"
    >
      審核通過
    </button>
    <button type="button" id="return" class="btn btn-danger my-2 returnButton">
      退件
    </button>
    <button type="button" id="printBtn" class="btn btn-secondary my-2">
      列印
    </button>
  </div>
</div>
<style>
  /* 讓表格內容換行 */
  .jsgrid-table {
    word-wrap: break-word;
  }

  input[type="text"] {
    width: 100%;
  }

  textarea {
    width: 100%;
  }
</style>

<script>
  //需要用的JS
  require([
    "jquery",
    "jquery_validate",
    "jsgrid",
    "jquery_ui",
    "print",
  ], function (jquery, jquery_validate, jsgrid, jquery_ui, print) {
    //頁面讀取後執行
    $(document).ready(function () {
      getByMenuId();
      function getByMenuId() {
        var menuid = 53;

        $.ajax({
          url:
            "/" +
            CONFIG.SYSTEM_NAME +
            "/buttonRole/api/getByMenuId?menuId=" +
            menuid,
          contentType: "application/json;charset=utf-8", // 因為上面是JSON
          async: false,
          cache: false,
          type: "GET",
          success: function (data, textStatus) {
            if (data && data == "<script>alert('沒有權限')<\/script>") {
              //showAlert('沒有權限','沒有權限','')
              showAlert("沒有權限", "沒有權限", "");
            } else {
              var menuData = data.data;
              get_list(menuData);
              if (menuData.jobLevel == "7") {
                $(".unit").show();
              } else {
                $(".unit").hide();
              }
              console.log(menuData);
              // 		<button type="button" id='submit_o' class="btn btn-warning  my-2 pressing_hide tempButton">暫存</button>
              // <button type="button" id='submit_s' class="btn btn-primary  my-2 pressing_hide sendButton">儲存送出</button>
              // <button type="button" id="checkBtn" class="btn btn-success  my-2 pressing_hide reviewButton">審核通過</button>
              // <button type="button" id="return" class="btn btn-danger  my-2 pressing_hide returnButton">退件</button>
              // <button type="button" id='submit_p' class="btn btn-primary  my-2 pressing_show sendButton">儲存送出</button>
              // <button type="button" id="printBtn1" class="btn btn-secondary  my-2 pressing_show printButton">列印</button>
              // <button type="button" id="printBtn" class="btn btn-secondary  my-2 pressing_hide printButton">列印</button>

              if (menuData.functionArray.indexOf("review") < 0) {
                $(".reviewButton").hide();
              }
              if (menuData.functionArray.indexOf("temp") < 0) {
                $(".tempButton").hide();
              }
              if (menuData.functionArray.indexOf("reject") < 0) {
                $(".returnButton").hide();
              }
              if (menuData.functionArray.indexOf("temp") < 0) {
                $(".tempButton").hide();
              }
            }
          },
          error: function (data, textStatus, errorThrown) {
            console.log(data);
          },
        });
      }
      var currentDate = new Date();
      var year = currentDate.getFullYear();
      var month = currentDate.getMonth() + 1;
      var monthprev = currentDate.getMonth();
      var day = currentDate.getDate();

      $(".itemYear").html(year);
      $(".upDate").html(year + "/" + month + "/" + day);
      $("#printBtn").click(function () {
        //printByDiv(document.getElementById("printDiv"));
        printJS({
          printable: "printDiv",
          type: "html",
          header: "",
          css: "../resources/css/print.css",
        });
      });
      //取得日期
      $("#testDate").datepicker({
        dateFormat: "yy/mm/dd",
        maxDate: 0,
      });
      isLogin(); //登入狀態
      function isLogin() {
        $.ajax({
          url: "/" + CONFIG.SYSTEM_NAME + "/login/api/getLogin",
          contentType: "application/json;charset=utf-8", // 因為上面是JSON
          async: false,
          cache: false,
          type: "get",
          success: function (data, textStatus) {
            if (data.msg != "success") {
              alert("您登入已逾時或未登入，請重新登入！");
              location.href = "/" + CONFIG.SYSTEM_NAME + "/page/login.html";
            }
          },
          error: function (data, textStatus, errorThrown) {
            console.log(data);
          },
        });
      }

      $("#Date").datepicker({
        autoclose: true, //選擇後自動關閉
        dateFormat: "yy/mm/dd",
        maxDate: 0,
      });

      $("#startDate").datepicker({
        autoclose: true, //選擇後自動關閉
        dateFormat: "yy/mm/dd",
        onClose: function (selectedDate) {
          $("#endDate").datepicker("option", "minDate", selectedDate);
        },
        maxDate: 0,
      });

      $("#endDate").datepicker({
        autoclose: true, //選擇後自動關閉
        dateFormat: "yy/mm/dd",

        minDate: $("#startDate").val(),
        onClose: function (selectedDate) {
          $("#startDate").datepicker("option", "maxDate", selectedDate);
        },
      });

      insert_mr();
      $("#submitBtn").click(function () {
        var tableData = [];
        var selectReturn = "是";
        var tableData2 = [];
        $("#secret tr").each(function (row, tr) {
          if (
            $(tr).find("td:eq(-1)").find("option:selected").val() == undefined
          ) {
            var opselect = $(tr).find("td:eq(-1)").find("input").val();
          } else {
            var opselect = $(tr)
              .find("td:eq(-1)")
              .find("option:selected")
              .val();
          }

          tableData[row] = {
            title: $(tr).find("td:eq(-2)").text().replace(/\s+/g, ""),
            selectData: opselect,
          };
        });

        var saveItem = {
          safetyId: $("#safety_fid").val(),
          formContent: JSON.stringify(tableData),
          status: "n",
          season: $("#season").find("option:selected").val(),
          upDate: year + "/" + month + "/" + day,
          requiredReviewId: $("#reviewName").find("option:selected").val(),
          requiredReviewName: $("#reviewName").find("option:selected").text(),
          version: "1.0.1",
        };
        console.log(saveItem);
        insert(saveItem);
      });
      $("#submitBtn_x").click(function () {
        var tableData = [];
        var selectReturn = "是";
        var tableData2 = [];
        $("#secret tr").each(function (row, tr) {
          if (
            $(tr).find("td:eq(-1)").find("option:selected").val() == undefined
          ) {
            var opselect = $(tr).find("td:eq(-1)").find("input").val();
          } else {
            var opselect = $(tr)
              .find("td:eq(-1)")
              .find("option:selected")
              .val();
          }
          tableData[row] = {
            title: $(tr).find("td:eq(-2)").text().replace(/\s+/g, ""),
            selectData: opselect,
          };
        });

        var saveItem = {
          safetyId: $("#safety_fid").val(),
          formContent: JSON.stringify(tableData),
          status: "t",
          season: $("#season").find("option:selected").val(),
          upDate: year + "/" + month + "/" + day,
          requiredReviewId: $("#reviewName").find("option:selected").val(),
          requiredReviewName: $("#reviewName").find("option:selected").text(),
          version: "1.0.1",
        };
        insert(saveItem);
      });
      //提交
      function insert(data) {
        console.log(JSON.stringify(data));
        $.ajax({
          data: JSON.stringify(data),
          url: "/" + CONFIG.SYSTEM_NAME + "/safetyMaintenanceOffice/api/save",
          contentType: "application/json;charset=utf-8", // 因為上面是JSON
          async: false,
          cache: false,
          type: "POST",
          success: function (data, textStatus) {
            if (data && data == 5000) {
              //showAlert('沒有權限','沒有權限','')
              showAlert("沒有權限", "沒有權限", "");
            }
            if (data.code == 7002 || data.code == "7002") {
              showAlert(
                "可上傳資料已達最大數量",
                "可上傳資料已達最大數量，無法上傳！",
                ""
              );
            }
            if (data.code == 7003 || data.code == "7003") {
              showAlert("訊息", "本筆資料已經上傳，無需重複送出！", "");
            } else {
              showAlert(
                "上傳成功",
                "公務機密維護總檢查上傳成功！",
                bodyHref("/content/safety/Safety_secret.html")
              );
              console.log(data);
            }
          },
          error: function (data, textStatus, errorThrown) {
            console.log(data);
          },
        });
      }
      $("#getlist_search").click(function () {
        getByMenuId();
      });
      function get_list(menuData) {
        if (menuData.jobLevel == "7") {
          var url = "safetyMaintenanceOffice/api/listAll";
        } else {
          var url = "safetyMaintenanceOffice/api/list";
        }
        $.ajax({
          url:
            "/" +
            CONFIG.SYSTEM_NAME +
            "/" +
            url +
            "?startDate=" +
            $("#startDate").val() +
            "&endDate=" +
            $("#endDate").val(),
          contentType: "application/json;charset=utf-8", // 因為上面是JSON
          async: false,
          cache: false,
          type: "GET",
          success: function (data, textStatus) {
            if (data && data == "<script>alert('沒有權限')<\/script>") {
              showAlert("沒有權限", "沒有權限", "");
            } else {
              var data = data.data;
              console.log("1");
              console.log(data);
              //提示
              $.toast({
                heading: "",
                text: "資料載入成功" + textStatus,
                icon: "success",
                position: "toast-top-center",
                hideAfter: 6000,
              });
              $("#jsGrid").jsGrid({
                width: "100%",
                height: "auto",
                heading: true, //是否顯示表頭
                filtering: false, //啟動查找
                inserting: false, //啟動新增  關掉使用自定義的
                editing: false, //啟動編輯
                selecting: true,
                sorting: true, //啟動排序
                paging: true, //啟動分頁
                pageLoading: false, //是否支援分頁載入資料（相比較paging，這個屬性是向伺服器請求資料時要求分頁，而paging是本機進行分頁，無關伺服器）
                autoload: true,
                pageSize: 10,

                controller: {
                  loadData: function (filter) {
                    //查詢
                    var result = $.grep(data, function (item, idx) {
                      for (var key in filter) {
                        var value = filter[key];
                        if (value.length > 0) {
                          if (!item[key]) {
                            return false;
                            callback(value.length);
                          }

                          if (typeof item[key] === "number") {
                            if (item[key].toString().indexOf(value) == -1) {
                              return false;
                              callback(item[key].toString().indexOf(value));
                            }
                          } else if (typeof item[key] === "string") {
                            if (item[key].indexOf(value) == -1) {
                              return false;
                              callback(item[key].indexOf(value));
                            }
                          }
                        }
                      }
                      return true;
                    });
                    return result;
                  },
                },
                fields: [
                  { title: "年度", name: "itemYear", type: "text" },
                  {
                    title: "填報季別",
                    name: "season",
                    type: "text",
                    itemTemplate: function (value, item) {
                      if (value == "1") {
                        return $("<span>").text("第一季度");
                      }
                      if (value == "2") {
                        return $("<span>").text("第二季度");
                      }
                      if (value == "3") {
                        return $("<span>").text("第三季度");
                      }
                      if (value == "4") {
                        return $("<span>").text("第四季度");
                      }
                    },
                  },
                  { title: "上傳日期", name: "addTime", type: "text" },
                  {
                    title: "狀態",
                    name: "status",
                    type: "text",
                    width: 80,
                    itemTemplate: function (value, item) {
                      if (value == "t") {
                        return $("<span>").text("暫存");
                      }
                      if (value == "n") {
                        return $("<span>").text("已送審");
                      }
                      if (value == "c") {
                        return $("<span>").text("已審核");
                      }
                      if (value == "r") {
                        return $("<span class='text-danger'>").text("已退件");
                      }
                      if (value == "p") {
                        return $("<span>").text("已處理");
                      }
                    },
                  },

                  {
                    title: "填表單位",
                    name: "unitName",
                    type: "text",
                    validate: "required",
                  },
                  {
                    title: "審核人員",
                    name: "requiredReviewName",
                    type: "text",
                    validate: "required",
                    // itemTemplate: function (value, item) {
                    // 		if(item.status=='c'){
                    // 			return  $("<span>").text(item.reviewName)
                    // 		}
                    // 		if(item.status=='r'){
                    // 			return  $("<span>").text(item.rejectName)
                    // 		}

                    // 	}
                  },

                  {
                    title: "操作",
                    name: "safetyId",
                    filtercss: "display:none;",
                    sorting: false,
                    type: "control",
                    width: 180,
                    itemTemplate: function (value, item) {
                      var $result =
                        jsGrid.fields.control.prototype.itemTemplate.apply(
                          this,
                          arguments
                        );

                      if (menuData.functionArray.indexOf("edit") < 0) {
                        var $customEditButton = "";
                      } else {
                        var $customEditButton = $("<button>")
                          .attr("type", "button")
                          .text("編輯")
                          .addClass("btn btn-primary")
                          .on("click", function () {
                            if (menuData.functionArray.indexOf("edit") < 0) {
                              showAlert("無編輯權限", "您沒有編輯權限", "");
                            } else {
                              if (item.status == "t" || item.status == "r") {
                                get_old(value);
                              } else {
                                shmsToast(
                                  (item.reviewId ? "當前狀態" : "當前狀態") +
                                    "無法編輯！！！"
                                );
                              }
                            }
                          });
                      }

                      var $customLookButton = $("<button>")
                        .attr("type", "button")
                        .text("查看")
                        .addClass("btn btn-success")
                        .on("click", function () {
                          showDetailsDialog("查看", item.safetyId);
                        });
                      return $("<div>")
                        .append($customEditButton)
                        .append($customLookButton);
                    },
                    headerTemplate: function () {
                      if (menuData.functionArray.indexOf("add") < 0) {
                        return "操作";
                      } else {
                        return $("<button>")
                          .attr("type", "button")
                          .text("新增")
                          .addClass("btn btn-primary")
                          .on("click", function () {
                            $("#season option").prop("disabled", true);

                            $.ajax({
                              url:
                                "/" +
                                CONFIG.SYSTEM_NAME +
                                "/safetyMaintenanceOffice/api/check?testNum=0",
                              contentType: "application/json;charset=utf-8", // 因為上面是JSON
                              async: false,
                              cache: false,
                              type: "GET",
                              success: function (data, textStatus) {
                                console.log(data.data);
                                if (data.data < 1 || data.data < "1") {
                                  $("#season option")
                                    .filter(function () {
                                      return $(this).val() == data.data + 1;
                                    })
                                    .prop("disabled", false);
                                  $("#season").val(data.data + 1);
                                  get_old("0");
                                } else {
                                  shmsToast(
                                    (data.data
                                      ? "尚未開放下次的上傳時間"
                                      : "尚未開放下次的上傳時間") +
                                      "，目前無法新增！"
                                  );
                                }
                              },
                            });
                          });
                      }
                    },
                  },
                ],
              });
            }
          },
          error: function (data, textStatus, errorThrown) {
            console.log(data);
          },
        });
      }
      //取得默認資料

      function insert_mr() {
        let id = 0;
        $("#id").val(id);
        $.ajax({
          data: JSON.stringify({ safetyNo: "" }),
          url: "/" + CONFIG.SYSTEM_NAME + "/safetyMaintenance/api/getInitData",
          contentType: "application/json;charset=utf-8", // 因為上面是JSON
          async: false,
          cache: false,
          type: "POST",
          success: function (data, textStatus) {
            if (data && data == "<script>alert('沒有權限')<\/script>") {
              //showAlert('沒有權限','沒有權限','')
              showAlert("沒有權限", "沒有權限", "");
            } else {
              initPage(data);
              console.log(data);
            }
          },
          error: function (data, textStatus, errorThrown) {
            console.log(data);
          },
        });
      }
      //默認資料帶入
      function initPage(data) {
        tempData = data;
        const originalArray = data.userList;
        const filteredArray = $.grep(originalArray, function (item) {
          return item.jobLevel === 14;
        });
        $(".unitId").html(data.unit.unitId);
        $(".unitName").html(data.unit.unitName);
        $(".loginUser").html(data.loginUser.name);
        $("#detailDialog  .reviewName").html(data.loginUser.name);
        createSelect("reviewName", filteredArray, "rocId", "name", "");
        $("#reviewName option[value='" + data.loginUser.rocId + "']").remove();
        // $('#upDate').html(Date())
      }
      var formSubmitHandler = $.noop;

      function get_old(item) {
        var item = item;
        if (item == "0") {
          showeditDialog("新增", item);
          $(".safety_fbox").show();
          $("#safety_fid").val("0");
        } else {
          var menuid = 53;
          $.ajax({
            url:
              "/" +
              CONFIG.SYSTEM_NAME +
              "/buttonRole/api/getByMenuId?menuId=" +
              menuid,
            contentType: "application/json;charset=utf-8", // 因為上面是JSON
            async: false,
            cache: false,
            type: "GET",
            success: function (data, textStatus) {
              if (data && data == "<script>alert('沒有權限')<\/script>") {
                //showAlert('沒有權限','沒有權限','')
                showAlert("沒有權限", "沒有權限", "");
              } else {
                var menuData = data.data;

                console.log(menuData);

                if (menuData.functionArray.indexOf("edit") < 0) {
                  showAlert("提示", "您沒有編輯當前資料的權限！", "");
                } else {
                  showeditDialog("編輯", item);
                  $(".safety_fbox").show();
                  $.ajax({
                    url:
                      "/" +
                      CONFIG.SYSTEM_NAME +
                      "/safetyMaintenanceOffice/api/get?safetyId=" +
                      item,
                    contentType: "application/json;charset=utf-8", // 因為上面是JSON資料
                    async: false,
                    cache: false,
                    type: "GET",
                    success: function (data, textStatus) {
                      if (data && data.code == "5000") {
                        showAlert("沒有權限", "沒有權限", "");
                      } else {
                        var data = data.data;
                        console.log(data);
                        $("#safety_fid").val(data.safetyId);
                        $(".season").html(data.season);
                        $("#season").val(data.season);
                        $("#season").attr("disabled", "disabled");
                        $(".loginUser").html(data.checkName);
                        $(".reviewName").html(data.requiredReviewName);
                        $("#reviewName").val(data.requiredReviewId);
                        $(".itemYear").html(data.itemYear);
                        $(".upDate").html(data.checkTime);
                        if (data.status == 'r') {
                        $("#return").hide();
								        }
								      if (data.status == 'c') {
									      $("#submitBtn_s").hide();
								          }
                        if (
                          data.formContent != "[{formContentJson}]" &&
                          data.formContent != "undefined" &&
                          data.formContent != undefined
                        ) {
                          var jsonStr = data.formContent;

                          var jsonObj = $.parseJSON(jsonStr);

                          var data_g = [];
                          $.each(jsonObj, function (index, item) {
                            data_g[index] = {
                              title: item.title,
                              selectData: item.selectData,
                              ramark: item.ramark,
                            };
                          });

                          $.each(data_g, function (index, item) {
                            $("#secret tbody tr")
                              .eq(index)
                              .find("td:eq(-2)")
                              .text(item.title);
                            $("#secret tbody tr")
                              .eq(index)
                              .find("td:eq(-1)")
                              .find("select")
                              .val(item.selectData.replace("undefined", ""));
                            $("#secret tbody tr")
                              .eq(index)
                              .find("td:eq(-1)")
                              .find("input")
                              .val(item.selectData.replace("undefined", ""));
                          });
                        }
                      }
                    },
                  });
                }
              }
            },
            error: function (data, textStatus, errorThrown) {
              console.log(data);
            },
          });
        }
      }
      var showeditDialog = function (dialogType, item) {
        $("#editDialog")
          .dialog("option", "title", dialogType + "")
          .dialog("open");
      };
      var showDetailsDialog = function (dialogType, item) {
        console.log(item);
        $("#detailDialog")
          .dialog("option", "title", dialogType + "")
          .dialog("open");
        if (item == "undefined" || item == undefined) {
          showAlert("提示", "當前資料內容為空，請編輯後查看！", "");
        } else {
          $.ajax({
            url:
              "/" +
              CONFIG.SYSTEM_NAME +
              "/safetyMaintenanceOffice/api/get?safetyId=" +
              item,
            contentType: "application/json;charset=utf-8", // 因為上面是JSON
            async: false,
            cache: false,
            type: "GET",
            success: function (data, textStatus) {
              if (data && data.code == "5000") {
                showAlert("沒有權限", "沒有權限", "");
              } else {
                var data = data.data;
                console.log(data);
                $("#detailDialog #safetyId").val(data.safetyId);
                if (
                  data.formContent != "[{formContentJson}]" &&
                  data.formContent != "undefined" &&
                  data.formContent != undefined
                ) {
                  var jsonStr = data.formContent;

                  var jsonObj = $.parseJSON(jsonStr);

                  var data_g = [];

                  $.each(jsonObj, function (index, item) {
                    data_g[index] = {
                      title: item.title,
                      selectData: item.selectData,
                    };
                  });

                  $("#secret_look tr").each(function (row, tr) {
                    $(tr).find("td:eq(-2)").text(data_g.title);
                    $(tr).find("td:eq(-1)").text(data_g.selectData);
                  });

                  $.each(data_g, function (index, item) {
                    $("#secret_look tr")
                      .eq(index)
                      .find("td:eq(-2)")
                      .text(item.title);
                    $("#secret_look tr")
                      .eq(index)
                      .find("td:eq(-1)")
                      .text(item.selectData.replace("undefined", ""));
                  });
                }
                if (data.season == "1") {
                  $("#detailDialog  .season").html("第一季度");
                }
                if (data.season == "2") {
                  $("#detailDialog  .season").html("第二季度");
                }
                if (data.season == "3") {
                  $("#detailDialog  .season").html("第三季度");
                }
                if (data.season == "4") {
                  $("#detailDialog  .season").html("第四季度");
                }

                $("#detailDialog  .loginUser").html(data.checkName);
                $("#detailDialog  .reviewName").html(data.requiredReviewName);
                $("#reviewName").val(data.requiredReviewId);
                $("#detailDialog  .upDate").html(data.checkTime);
                $("#detailDialog .itemYear").html(data.itemYear);
                if (data.status == "r") {
                  $("#detailDialog #printDiv .headtable tbody").append(
                    '<tr><td class="table-header " width="200">退件原因</td><td class="" colspan="3">' +
                      data.rejectReason +
                      "</td></tr>"
                  );
                }
              }
            },
          });
        }
      };

      //查看
      $("#detailDialog").dialog({
        title: "參數設定",
        autoOpen: false,
        width: 960,
        height: 550,

        modal: true,
        close: function () {
          bodyHref("/content/safety/Safety_secret.html");
        },
        open: function (event, ui) {
          $(".ui-widget-overlay").addClass("custom-overlay");
          customCloseBtn();
        },
        classes: dlgSetting.classes,
        show: dlgSetting.show,
        hide: dlgSetting.hide,
      });

      $("#editDialog").dialog({
        title: "參數設定",
        autoOpen: false,
        width: 960,
        height: 550,

        modal: true,
        close: function () {},
        open: function (event, ui) {
          $(".ui-widget-overlay").addClass("custom-overlay");
          customCloseBtn();
        },
        classes: dlgSetting.classes,
        show: dlgSetting.show,
        hide: dlgSetting.hide,
      });

      //通報退件
      $("#return").click(function () {
        $("#dialog-return").addClass("shows");
        $("#dialog-return").removeClass("hides");
        $("#returnReason1").removeAttr("disabled");
      });
      $("#returnFormSubmit").click(function () {
        cancleBtnsubmit();
      });
      $("#submitBtn_s").click(function () {
        AuditBtnsubmit();
      });
      $("#returncancel").click(function () {
        $("#dialog-return").addClass("hides");
        $("#dialog-return").removeClass("shows");
      });
      function cancleBtnsubmit() {
        var id = parseFloat($("#safetyId").val());
        var data = { safetyId: id, rejectReason: $("#returnReason1").val() };
        console.log(JSON.stringify(data));
        return $.ajax({
          url: "/" + CONFIG.SYSTEM_NAME + "/safetyMaintenanceOffice/api/reject",
          data: JSON.stringify(data),
          contentType: "application/json;charset=utf-8", // 因為上面是JSON
          type: "POST",
          dataType: "json",
          success: function (data, textStatus) {
            console.log(data);
            if (data && data.code == 5000) {
              showAlert("沒有權限", "沒有權限", "");
            } else {
              if (data.code == 0) {
                showAlert(
                  "拒絕通報成功",
                  "拒絕通報成功",
                  bodyHref("/content/safety/Safety_secret.html")
                );
                $.toast({
                  heading: "",
                  text: "拒絕通報成功" + textStatus,
                  icon: "success",
                  position: "toast-top-center",
                  hideAfter: 6000,
                });
              } else if (data.errorMsg) {
                alert(data.errorMsg);
              }
            }
          },
          error: function (data, textStatus, errorThrown) {
            console.log(data);
            alert("拒絕通報失敗" + data + "," + JSON.stringify(updatingItem));
          },
        });
      }
      function AuditBtnsubmit() {
        var id = parseFloat($("#safetyId").val());
        var data = { safetyId: id };
        console.log(JSON.stringify(data));
        return $.ajax({
          url: "/" + CONFIG.SYSTEM_NAME + "/safetyMaintenanceOffice/api/review",
          data: JSON.stringify(data),
          contentType: "application/json;charset=utf-8", // 因為上面是JSON
          type: "POST",
          dataType: "json",
          success: function (data, textStatus) {
            console.log(data);
            if (data && data.code == 5000) {
              showAlert("沒有權限", "沒有權限", "");
            } else {
              if (data.code == 0) {
                showAlert(
                  "審核通報成功",
                  "審核通報成功",
                  bodyHref("/content/safety/Safety_secret.html")
                );
                $.toast({
                  heading: "",
                  text: "審核通報成功" + textStatus,
                  icon: "success",
                  position: "toast-top-center",
                  hideAfter: 6000,
                });
              } else if (data.errorMsg) {
                alert(data.errorMsg);
              }
            }
          },
          error: function (data, textStatus, errorThrown) {
            console.log(data);
            alert("審核通報失敗" + data + "," + JSON.stringify(updatingItem));
          },
        });
      }
      //創建select
      function createSelect(id, data, key, val, eventKey) {
        $.each(data, function (index, item) {
          $("#" + id).append(
            $("<option>")
              .val(item[key])
              .text(eventKey ? item[eventKey] + "_" + item[val] : item[val])
          );
          $("#" + id + "1").append(
            $("<a>").html(item[val]).addClass("dropdown-item")
          );
        });
      }
    });
  });
</script>
